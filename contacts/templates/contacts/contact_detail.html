{% extends 'contacts/base.html' %}
{% load bootstrap3 %}

{% block title %}Détail du contact {{ object }}{% endblock %}

{% block content %}
<h2>Détail du contact {{ object }}</h2>
    <div>{{ object }}</div>
    <dl>
    {% if object.company %}
        <dt>Société</dt>
        <dd><a href="{{ object.company.get_absolute_url }}">{{ object.company }}</a></dd>
    {% endif %}
    {% for prop_name, prop_value in object.properties.items %}
        <dt>{{ prop_name }}</dt>
        <dd>{{ prop_value }}</dd>
    {% endfor %}
    </dl>
    {% if perms.contacts.view_meeting %}
    <h3>Rencontres</h3>
    {% if perms.contacts.add_meeting %}
    <div><a href="{% url 'contacts:meeting-create' contact=object.slug %}"
          class="btn btn-info">{% bootstrap_icon 'plus' %} ajouter une rencontre</a></div>
    {% endif %}
    <table class="table">
        <tr><th>Date</th>
            <th>Type</th>
            <th>Auteur</th>
            <th>Commentaire</th>
            <th>Actions</th>
        </tr>
        {% for meeting in object.meetings.all %}
        <tr><td>{{ meeting.date }}</td>
            <td>{{ meeting.type }}</td>
            <td>{{ meeting.author }}</td>
            <td>{{ meeting.comments }}</td>
            <td>{% if perms.contacts.change_meeting %}<a href="{% url 'contacts:meeting-update' pk=meeting.pk %}">{% bootstrap_icon 'pencil' %}</a>{% endif %}
                {% if perms.contacts.delete_meeting %}<a href="{% url 'contacts:meeting-delete' pk=meeting.pk %}">{% bootstrap_icon 'trash' %}</a></td>{% endif %}
        </tr>
        {% empty %}
        <tr><td colspan="5">Ce contact ne possède pour l’instant aucune rencontre.</td></tr>
        {% endfor %}
    </table>
    {% endif %}

    <div>
    {% if perms.contacts.change_contact %}
    <a href="{% url 'contacts:contact-update' slug=object.slug %}"
        class="btn btn-info">modifier le contact</a>
    {% endif %}
    {% if perms.contacts.delete_contact %}
    <a href="{% url 'contacts:contact-delete' slug=object.slug %}"
        class="btn btn-danger">Supprimer le contact</a>
    {% endif %}
    </div>
{% endblock %}
